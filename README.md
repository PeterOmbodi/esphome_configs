# ESPHome Configuration: Battery, Weather, Solar Forecast, and Power Meters

This repository contains a ESPHome configuration for an ESP32-based 320Ã—240 LVGL touchscreen (CYD - cheap yellow display). 
It displays live data from a JK BMS, weather information from OpenWeatherMap, solar irradiance forecast from Solcast, and real-time energy flow metrics for solar and grid usage.

---

## ğŸ”‹ Battery Monitoring (JK BMS)

- **Battery SOC** displayed as percentage with icon and bar
- **Battery Power** (charge/discharge) shown with dynamic color bar
  - Blue = charging
  - Yellow = mild discharge
  - Red = heavy discharge
- Icons are Unicode characters rendered from Material Design Icons (MDI)

---

## ğŸŒ¤ Weather (OpenWeatherMap)

- **Temperature** with Â°C and weather icon
- **Humidity** with % and water drop icon
- **Weather condition** (e.g. "Sunny", "Cloudy") in Ukrainian
- Icons are matched by condition string using `text_sensor` and `lambda`

---

## â˜€ï¸ PV Forecast (Solcast)

- Displays **forecasted solar irradiance** from Solcast via Home Assistant sensor
- Icon rendered as sun with rays
- Useful for estimating solar availability for off-grid or hybrid setups

---

## âš¡ Power Meters

- **Solar PV Generation** â€” `sensor.solar2mqtt_pv_charging_power`
  - Shows how much power is currently being generated by your solar panels
- **Grid Power Consumption** â€” `sensor.xoca_dac2121c_bi_phase_a_power`
  - Displays how much energy is being drawn from the public grid
- **Household Power Load** â€” `sensor.solar2mqtt_ac_out_watt`
  - Shows how much energy your household is consuming in real time

These values are visualized via bars and labels, using dynamic coloring and clear units (`W`, `%`, etc.).

---

## ğŸ–¥ User Interface (LVGL)

- UI layout uses `obj:` and `layout: GRID` for consistent structure
- All labels, bars, and images use proper alignment and spacing
- Fonts:
  - Roboto Condensed for text
  - FontAwesome or MDI for icons
- Cyrillic characters supported (Ukrainian)

---

## ğŸ“ File Structure

```
.CYD
  â”œâ”€â”€ esphome-lvgl.yaml               # Main configuration file
  â”œâ”€â”€ secrets.yaml                    # WiFi, MQTT and other credentials (not included)
  â”œâ”€â”€ images/                         # Optional: image assets for icons (if used)
  â””â”€â”€ fonts/                          # Font files used in display
```
## ğŸ“· Screenshots

![photo_2025-05-26_14-10-23](https://github.com/user-attachments/assets/52f9af74-afca-4ec8-9734-59765b6c453c)

---

## ğŸ§© Requirements

- **ESP32** (with enough PSRAM, e.g. WROVER recommended)
- 320Ã—240 TFT or IPS touch display 
- Home Assistant with:
  - `sensor.jk_bms_*` for BMS
  - `sensor.openweathermap_*` for weather
  - `sensor.solcast_pv_forecast_*` for solar forecast
  - `sensor.solar2mqtt_*` and `sensor.xoca_*` for power meters
- Fonts with support for required Unicode glyphs

---

## ğŸš€ Setup Instructions

1. Copy the contents of esphome-lvgl.yaml into your own ESPHome configuration file.
Then update the esphome.name field to match the actual name of your device, for example:
esphome:
  name: my-touchscreen-node

3. Copy required fonts into your ESPHome fonts/ folder.
4. Add or update your `secrets.yaml` as needed.
5. Make sure all referenced sensors exist in Home Assistant.
6. Open ESPHome and compile/upload the configuration.
7. Enjoy your informative, real-time solar and battery dashboard!

---

## ğŸ›  To Do / Ideas

- Add gesture navigation between multiple screens
- Expand to show historical graphs or max PV forecast for today

---

## ğŸ™ Credits

This configuration is based on the excellent example by [ivan-rio](https://github.com/ivan-rio).  
Special thanks to him for the code structure and the clear walkthrough in his video:  
ğŸ“º [ĞšÑ€ÑƒÑ‚Ğ¸Ğ¹ Ğ´Ğ¸ÑĞ¿Ğ»ĞµĞ¹ Ğ´Ğ»Ñ Home Assistant | LVGL Ğ² ESPHome](https://www.youtube.com/watch?v=efeK-VodNlA)
---

## ğŸ“„ License

MIT License â€” free to use, modify, and contribute.
